<!doctype html>
<html is="dmx-app">

<head>
	<meta name="ac:route" content="/admin">
	<base href="/">
	<script src="dmxAppConnect/dmxAppConnect.js"></script>
	<meta charset="UTF-8">
	<title>Admin</title>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="bootstrap/4/css/bootstrap.min.css" />
	<script src="dmxAppConnect/dmxBootstrap4Navigation/dmxBootstrap4Navigation.js" defer=""></script>
	<script src="dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer=""></script>
	<script src="dmxAppConnect/dmxBrowser/dmxBrowser.js" defer=""></script>
	<script src="dmxAppConnect/dmxFormatter/dmxFormatter.js" defer=""></script>
	<script src="dmxAppConnect/dmxBootstrap4Alert/dmxBootstrap4Alert.js" defer=""></script>
	<script src="dmxAppConnect/dmxBootstrap4Modal/dmxBootstrap4Modal.js" defer=""></script>
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="dmxAppConnect/dmxValidator/dmxValidator.css" />
	<script src="dmxAppConnect/dmxValidator/dmxValidator.js" defer=""></script>
	<script src="dmxAppConnect/dmxTyped/dmxTyped.js" defer=""></script>
	<script src="dmxAppConnect/dmxTyped/typed.min.js" defer=""></script>
</head>

<body id="admin">
	<dmx-serverconnect id="changeUserRole" url="api/Manager/change_user_role" noload dmx-on:success="redirect.goto('http://localhost:8100/admin')"></dmx-serverconnect>

	<dmx-serverconnect id="loadUsers" url="api/Manager/get_all_users" noload></dmx-serverconnect>
	<dmx-serverconnect id="add_service_type" url="api/Manager/add_service" noload></dmx-serverconnect>
	<dmx-serverconnect id="view_service_types" url="api/Manager/view_service_types" noload></dmx-serverconnect>
	<dmx-serverconnect id="cars" url="api/Retrieve_images/query_all_images" noload></dmx-serverconnect>

	<dmx-serverconnect id="add_moderator" url="api/Manager/add_new_moderator" noload dmx-on:success="moderator_added.show()" dmx-on:error="moderator_error.show()"></dmx-serverconnect>


	<div is="dmx-browser" id="redirect"></div>
	<script is="dmx-flow" id="flow" type="text/dmx-flow">{
  meta: {
    $param: [
      {type: "text", name: "ROLE"}
    ]
  },
  exec: {
    steps: {
      condition: {
        if: "{{$param.ROLE=='Moderator'}}",
        then: {
          steps: {
            run: {name: "k", disabled: true}
          }
        },
        else: {
          steps: {
            run: {action: "{{redirect.goto('http://localhost:8100/')}}", name: "red"}
          }
        }
      }
    }
  }
}</script>
	<dmx-value id="ok" dmx-bind:value="-1"></dmx-value>
	<dmx-session-manager id="session"></dmx-session-manager>
	<dmx-serverconnect id="restrict_access" url="api/Data/restrict" dmx-param:id="session.data.user_id" dmx-on:success="flow.run({ROLE: restrict_access.data.query[0].role})" dmx-on:error="redirect.goto('http://localhost:8100/')"></dmx-serverconnect>



	<div class="container">
		<div class="row">
			<div class="col text-center mt-3">
				<h1 class="font-weight-light">Moderator View</h1>
			</div>
		</div>

	</div>
	<div class="row mt-3 pl-5">
		<div class="col text-left border-bottom ml-0">

			<h3 class="font-weight-light">Manage users<button id="load_users" class="btn ml-4 btn-outline-primary" dmx-on:click="loadUsers.load()">Load users</button></h3>
		</div>
	</div>


	<div class="row mt-2 pl-5 row-cols-3" is="dmx-repeat" id="repeat2" dmx-bind:repeat="loadUsers.data.custom">

		<div class="col-2 border-dark border border-right-0 mb-1">
			<h5 class="font-weight-light" id="number" dmx-text="id">Fancy display heading</h5>
		</div>
		<div class="border border-right-0 border-left-0 border-dark mb-1 col-3">
			<h5 class="font-weight-light" dmx-text="email">Fancy display heading</h5>
		</div>
		<div class="border border-right-0 border-left-0 border-dark mb-1 col-2">
			<h5 class="font-weight-light" dmx-text="username">Fancy display heading</h5>
		</div>
		<div class="col border border-left-0 border-dark mb-1">
			<dmx-value id="make_opposite"></dmx-value>
			<dmx-value id="status" dmx-on:updated="flow1.run()" dmx-bind:value="role"></dmx-value>
			<div class="row row-cols-3">
				<script is="dmx-flow" id="flow1" type="text/dmx-flow" autorun>{
  condition: {
    if: "{{role=='Moderator'}}",
    then: {
      steps: {
        run: {action: "{{make_opposite.setValue('User')}}"}
      }
    },
    else: {
      steps: {
        run: {action: "{{make_opposite.setValue('Moderator')}}"}
      }
    }
  }
}</script>


				<div class="col">
					<h5 class="font-weight-light" dmx-text="role" id="role">Fancy display heading</h5>
				</div>
				<div class="col-5"><button id="btn1" class="btn btn-sm btn-outline-primary" dmx-text="'Make&nbsp;'+make_opposite.value" dmx-on:click="changeUserRole.load({email: email, role: make_opposite.value})">Button
					</button></div>
				<div class="col-3">
					<button id="btn2" class="btn btn-outline-danger btn-sm">Delete</button>
				</div>
			</div>


		</div>
	</div>
	<div class="row mt-3 pl-5">
		<div class="col text-left border-bottom ml-0">

			<h3 class="font-weight-light">Manage users<button id="load_users1" class="btn ml-4 btn-outline-primary" dmx-on:click="loadUsers.load()">Load users</button></h3>
		</div>
	</div>
	<div class="row mt-3 pl-5">
		<div class="col text-left border-bottom ml-0">

			<h3 class="font-weight-light">Manage products<button id="load" class="btn btn-outline-primary ml-4" dmx-on:click="cars.load({})" wappler-command="editContent">Load cars</button></h3>
		</div>
	</div>
	<div class="row mt-3 pl-5 row-cols-3" is="dmx-repeat" id="repeat1" dmx-bind:repeat="cars.data.query1">
		<div class="text-left ml-0 col">
			<div class="card mb-3">
				<img class="card-img-top" alt="Card image cap" dmx-bind:src="image">
				<div class="card-body">
					<h4 class="card-title" dmx-text="make+' - '+model">Card title</h4>
					<a href="#" class="btn btn-primary">Edit&nbsp;<i class="fa fa-search-plus"></i></a>
				</div>
			</div>

		</div>
	</div>
	<div class="container wappler-block pt-3 pb-3">
		<div class="modal" id="moderator_added" is="dmx-bs4-modal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-body">
						<p class="text-center text-success"><i class="fa fa-check"></i></p>
						<h4 class="text-center font-weight-light">Success!</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container wappler-block pt-3 pb-3">
		<div class="modal" id="moderator_error" is="dmx-bs4-modal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-body">
						<p class="text-center text-danger"><i class="fa fa-times"></i></p>
						<h4 class="text-center font-weight-light">Error!</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="bootstrap/4/js/popper.min.js"></script>
	<script src="bootstrap/4/js/bootstrap.min.js"></script>
</body>

</html>